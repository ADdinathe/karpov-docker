# Создание образа
DOCKERFILE - это обычный текстовый файл, где мы при помощи инструкций (FROM, CMD и т.д.) описываем каким должен быть наш образ, то есть расширяем его функционал. Каждая инструкция создает слой.
## Пример DOCKERFILE
```
# Указываем образ для контейнера
FROM node:17 

# Копируем файл в директорию app
COPY ./script.js /app/script.js

# Запускаем скрипт при поднятии контейнера
CMD ["node", "/app/script.js"]
```

## Несколько BEST PRACTICES
1. Использовать ```.dockerignore``` файл (ex. игнорируем файлы с секретными данными). Нельзя токены, пароли класть в образы.
2. Устанавливать только то, что действительно нужно
3. Стараться уменьшить количество слоев

### Пример 6 слоев в один
Так делать не надо:
```
RUN apt-get update 
RUN apt-get install -y vim
RUN apt-get install -y python3
RUN apt-get install -y python3-pip
RUN apt-get install -y curl
RUN apt-get install -y git
```

А так надо (обновляем и устанавливаем в одном слое):
```
RUN apt-get update && apt-get install -y \
vim \
python3 \
python3-pip \
curl \
git
```

## Сделаем свой образ кастомной убунты
1. Создадим ```Dockerfile```
2. Указываем базовый образ
```
FROM ubuntu:20.04
```
3. Указываем рабочую директорию
```
WORKDIR /home/igor
```
4. Собираем наш образ командой ```docker build```:
Опция ```-t``` означает, что мы задаем имя и тэг нашего образа.
А затем указываем папку, в которой находится Dockerfile. Можно поставить точку ``` .```, что соотвествует текущей папке.
Также можно добавить опцию ```-f``` и указать точное название Dockerfile (если его название отличается от Dockerfile)
```
docker build -t custom_ubuntu:1
```
5. А теперь посмотрим список образов и увидим наш образ
```
docker images
```
6. Расширим Dockerfile, добавив файлы к образу инструкцией (ADD или COPY)
```
COPY <ПУТЬ К ФАЙЛУ НА НАШЕМ ПК> <ПУТЬ К ФАЙЛУ В КОНТЕЙНЕРЕ>
COPY random_file.txt random_file.sh
```

Этот файл будет лежать в /home/igor/random_file.sh, так как до этого указали WORKDIR

7. Соберем образ с тэгом 2
```
docker build -t custom_ubuntu:2
```

8. Установим nano, wget и curl при помощи инструкции RUN
```
RUN apt-get update && apt-get install -y nano wget curl git
```
Очевидно, что пункт 8 никогда не будет меняться, так как все ПО будет присутсвовать во всех сборках (очень нужное ПО), поэтому лучше его поднять выше до определения директорий, чтобы эта инструкция закешировалась. 

ВАЖНО! Вверх нужно поднимать те инструкции, которые точно не будут изменены.




